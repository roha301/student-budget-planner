{% extends 'base.html' %}

{% block content %}
<main class="glass-card">
  <h2>Create account</h2>
  <form id="register-form">
    <label>Username<input name="username" required></label><br>
    <label>Email<input name="email" type="email"></label><br>
    <label>Password<input name="password" type="password" required></label><br>
    <button type="submit">Register</button>
  </form>
  <div id="msg"></div>
</main>
<script>
document.getElementById('register-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const form = e.target;
  const data = {username: form.username.value, email: form.email.value, password: form.password.value};
  const res = await fetch('/api/auth/register/', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data)});
  const json = await res.json();
  if(res.status===201){ localStorage.setItem('token', json.token); document.getElementById('msg').textContent='Registered, token stored.' } else { document.getElementById('msg').textContent=JSON.stringify(json) }
});
</script>
{% endblock %}